<div data-controller="messages">

<div class="container mt-4">
  <h2>Your Messages</h2>
  <table class="table">
    <thead>
    <tr>
      <th>From</th>
      <th>Subject</th>
      <th>Message</th>
      <th></th>
      <th></th>

    </tr>
    </thead>
    <tbody>
    <% @messages.each do |message| %>
      <tr>
        <td><%= message[:sender_name] %></td>
        <td>
          <%= truncate(message[:subject], length: 20) %>
        </td>
        <td>
          <%= truncate(message[:message], length: 20) %>
        </td>
        <td>
          <%= link_to "View Details", message_details_path(message_id: message[:id]), method: :get, class: "btn btn-primary" %>
        </td>
        <td>
          <button class="btn btn-danger delete-message"
                  type="button"
                  data-action="messages#updateDeleteModal"
                  data-messages-message-id-param="<%= message[:id] %>"
                  data-bs-toggle="modal"
                  data-bs-target="#confirmationModal">
            Delete
          </button>

        </td>
      </tr>
    <% end %>
    </tbody>

  </table>
</div>
  <div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmationModalLabel">Confirm Deletion</h5>
        </div>
        <div class="modal-body">
          Are you sure you want to delete this message?
        </div>
        <div class="modal-footer">
          <%= bootstrap_form_with url: delete_message_path, method: :delete, id: "confirmDeleteForm" do |f| %>
            <%= f.hidden_field(
                  :message_id,
                  id: "messageIdPlaceholder",
                  data: { messages_target: "hiddenMessageField" }
                ) %>
            <%= f.hidden_field :confirmation, value: "yes" %>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" aria-label="Close">Close</button>
            <%= f.submit "Delete", class: "btn btn-danger" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

</div>