<head>
  <%= stylesheet_link_tag "checkouts" %>
  <title></title></head>
    <div class="row">
      <div class="col-md-7">
        <h2>
          <% if @products_in_cart.empty? %>
            <%= @empty %>
          <% else %>
            <%= "Your Cart" %>
          <% end %>
        </h2>
        <table class="table">
          <thead>
          <tr>
            <th>Product</th>
            <th>Quantity</th>
            <th>Total Cost</th>
            <th></th>
          </tr>
          </thead>
          <% cart_price = 0 %>
          <tbody>
          <% @products_in_cart.each do |product| %>
            <tr>
              <td><%= product[:name] %></td>
              <td>
                <%= form_tag update_quantity_path, method: :post do %>
                  <%= hidden_field_tag :product_id, product[:id] %>
                  <%= select_tag :quantity, options_for_select((1..@current_quantity_of_product).to_a, selected: product[:quantity]) %>
                  <%= submit_tag "Update", class: "btn btn-secondary" %>
                <% end %>
              </td>
              <% total_price = product[:price] * product[:quantity] / 100.00 %>
              <% cart_price += total_price %>
              <td>$<%= total_price %></td>
              <td>
                <%= form_tag remove_item_path, method: :delete, class: "delete-item" do %>
                  <%= hidden_field_tag :product_id, product[:id] %>
                  <%= submit_tag "Delete", class: "btn btn-danger" %>
                <% end %>
              </td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
      <div class="col-md-5">

<br>
        <h3>Payment</h3>
        <%= bootstrap_form_with url: update_product_inventory_path, method: :post, local: true do |f| %>
          <div class="row">
            <div class="col-md-6">
              <%= f.text_field :first_name, label: "First Name", placeholder: "First Name", required: true %>
            </div>
            <div class="col-md-6">
              <%= f.text_field :last_name, label: "Last Name", placeholder: "Last Name", required: true %>
            </div>
          </div>
              <%= f.text_field :address, label: 'Street Address: ', placeholder: "Street Address", required: true%>
          <div class="row">
            <div class="col-md-6">
              <%= f.text_field :city, label: 'City: ',placeholder: "City", required: true %>
            </div>
            <div class="col-md-2">
              <%= f.text_field :state, label: 'State: ', placeholder: "State", required: true %>
            </div>
            <div class="col-md-4">
              <%= f.text_field :zipcode, label: 'Zipcode: ',placeholder: "Zipcode", required: true %>
            </div>
          </div>
              <%= f.text_field :card_number, label: 'Card Number: ',placeholder: "Card Number", required: true%>
          <div class="row">
            <div class="col-md-6">
              <%= f.text_field :expiry_date, label: 'Expiration Date: ', placeholder: 'MM/YY', required: true %>
            </div>
            <div class="col-md-6">
              <%= f.text_field :cvc, label: 'CVC: ', placeholder: "CVC", required: true %>
            </div>
          </div>
          <%= f.form_group :shipping, label: { text: "Shipping" } do %>
            <%= f.radio_button :shipping, 999, label: "Expedited: 1-3 business days ($9.99)", required: true %>
            <%= f.radio_button :shipping, 499, label: "Regular: 4-7 business days ($4.99)", required: true %>
          <% end %>
          <br>
          <h3>Total: $<%= cart_price %></h3>

          <%= f.submit "Pay Now", class: "btn btn-primary" %>
        <% end %>

      </div>
      </div>





  <!-- Delete item confirmation -->
  <div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmationModalLabel">Confirm Deletion</h5>
        </div>
        <div class="modal-body">
          Are you sure you want to remove this item from your cart?
        </div>
        <div class="modal-footer">
          <%= link_to "Cancel", checkout_path, method: :get, class: "btn btn-secondary"%>
          <%= link_to "Delete", remove_item_path, method: :delete, class: "btn btn-danger", id: "confirmDeleteLink"%>
        </div>
      </div>
    </div>
  </div>
<script>
    $(document).ready(function() {
        // Show the confirmation modal when the "Delete" button is clicked
        $('.delete-item').click(function(event) {
            event.preventDefault(); // Prevent the default form submission
            $('#confirmationModal').modal('show');
        });

        // Update the action of the form to include a confirmation parameter when the modal is shown
        $('#confirmationModal').on('show.bs.modal', function(event) {
            const form = $('.delete-item');
            const originalAction = form.attr('action');
            const actionWithConfirmation = originalAction + '?confirmation=yes';
            form.attr('action', actionWithConfirmation);
        });

        // Handle the "Delete" link click in the modal
        $('#confirmDeleteLink').click(function(event) {
            // Manually submit the form with the updated action
            event.preventDefault(); // Prevent the default form submission
            $('.delete-item').submit();
        });
    });

</script>



